<html>
<head>
<title>index.html</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="woo.css" type="text/css">

<script>
   window.addEventListener("load", function() {
      var button = document.getElementById("connect");
      var status = document.getElementById("status");
      var output = document.getElementById("output");
      var connectTime = document.getElementById("connecttime");
      var output_mes= document.getElementById("output_mes");
      var source ;
      

      function connect() {
        source = new EventSource("sse");
        source.addEventListener("message", function(event) {
          output.textContent = "服务器推送信息:"+event.data;

          //
          function readBody(xhr) {
              var data;
              if (!xhr.responseType || xhr.responseType === "text") {
                  data = xhr.responseText;
              } else if (xhr.responseType === "document") {
                  data = xhr.responseXML;
              } else {
                  data = xhr.response;
                  alert(data);
              }
              return data;
          };

          var xhr = new XMLHttpRequest();
          xhr.open('GET', event.data,true);
          xhr.onload = function() {
           output_mes.innerHTML = "Message: " + readBody(xhr) + '<br />';
          };
          xhr.send(null);

        }, false);

        source.addEventListener("connecttime", function(event) {
          connectTime.textContent = "最后连接时间: " + event.data;
        }, false);

        source.addEventListener("open", function(event) {
          button.value = "Disconnect";

          button.onclick = function(event) {
            source.close();
            button.value = "Connect";
            button.onclick = connect;
            status.textContent = "Connection closed!";
          };
          status.textContent = "Connection open!";
        }, false);

        source.addEventListener("error", function(event) {
          
          if (event.target.readyState === EventSource.CLOSED) {
            source.close();
            status.textContent = "Connection closed!";
          } else if (event.target.readyState === EventSource.CONNECTING) {
            status.textContent = "Connection closed. Attempting to reconnect!";
          } else {
            status.textContent = "Connection closed. Unknown error!";
          }
        }, false);
      }

      if (!!window.EventSource) {
        connect();
      } else {
        button.style.display = "none";
        status.textContent = "Sorry, your browser doesn't support server-sent events";
      }
    }, false);
</script>
</head>
<body>

	<h1>嗨，我是大标题</h1>
	
   
  <input type="button" id="connect" value="Connect" /><br />
  <span id="status">Connection closed!</span><br />
  <span id="connecttime"></span><br />
  <span id="output"></span>
  <span id="output_mes"></span>


  <img src='/1.jpg'/>
	<script src='/wooo.js'></script>
</body>
</html>
















